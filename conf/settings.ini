#!/system/bin/sh


# ==============================================================================
# TProxyShell Core Configuration (settings.ini)
# Note: A service restart is required after modifying this file.
# ==============================================================================

# ------------------------------------------------------------------------------
# [ Subscription Settings ]
# ------------------------------------------------------------------------------
SUBSCRIPTION_URL=""


# ------------------------------------------------------------------------------
# [ Log Configuration ]
# ------------------------------------------------------------------------------
# Log settings: 0=Disable, 1=Enable
LOG_ENABLE=0
LOG_LEVEL=1                # 0=Debug 1=Info 2=Warn 3=Error
LOG_MAX_SIZE=1048576    # Log rotation size (bytes)


# ------------------------------------------------------------------------------
# [ Timeout & Update Settings ]
# ------------------------------------------------------------------------------
# Service start timeout
CORE_TIMEOUT=10         # Timeout for core start/stop operations

# Update settings
RETRY_COUNT=3           # Number of retries
UPDATE_INTERVAL=86400   # Auto-update check interval (seconds)


# ------------------------------------------------------------------------------
# [ Core Configuration ]
# ------------------------------------------------------------------------------
# User and Group to run the proxy core
CORE_USER="root"
CORE_GROUP="root"

# Traffic Mark (Fwmark) - identifies traffic to be proxied
# Leave empty to use OWNER match for core process identification
ROUTING_MARK="2025"

# Routing Table ID - used for transparent proxy routing
TABLE_ID=2025


# ------------------------------------------------------------------------------
# [ Port Configuration ]
# ------------------------------------------------------------------------------
# Transparent Proxy Ports (TCP/UDP)
PROXY_TCP_PORT="1536"
PROXY_UDP_PORT="1536"

# DNS Listener Port
DNS_PORT="1053"


# ------------------------------------------------------------------------------
# [ Proxy Mode Selection ]
# ------------------------------------------------------------------------------
# Proxy Mode: 0=Auto Detect, 1=Force TProxy, 2=Force Redirect
PROXY_MODE=0

# DNS Hijack: 0=Disable, 1=TProxy, 2=Redirect
DNS_HIJACK_ENABLE=1


# ------------------------------------------------------------------------------
# [ Network Interfaces ]
# ------------------------------------------------------------------------------
MOBILE_INTERFACE="rmnet_data+"
WIFI_INTERFACE="wlan0"
HOTSPOT_INTERFACE="wlan2"
USB_INTERFACE="rndis+"


# ------------------------------------------------------------------------------
# [ Proxy Scope Switches ]
# ------------------------------------------------------------------------------
# 0 = Disable, 1 = Enable
PROXY_MOBILE=1
PROXY_WIFI=1
PROXY_HOTSPOT=0
PROXY_USB=0

PROXY_TCP=1
PROXY_UDP=1
PROXY_IPV6=0


# ------------------------------------------------------------------------------
# [ Internal Marks ] (Do not modify unless necessary)
# ------------------------------------------------------------------------------
MARK_VALUE=20
MARK_VALUE6=25


# ------------------------------------------------------------------------------
# [ Per-App Proxy Settings ]
# ------------------------------------------------------------------------------
# Enable Per-App Proxy: 0=Disable, 1=Enable
APP_PROXY_ENABLE=0

# Mode: 1 = Blacklist (Default), 2 = Whitelist
APP_PROXY_MODE=1

# Proxy List (For Whitelist Mode)
# Formatting: Space-separated package names. 
# Multi-line strings are supported for better readability.
PROXY_APPS_LIST=""

# Bypass List (For Blacklist Mode)
BYPASS_APPS_LIST=""


# ------------------------------------------------------------------------------
# [ CN IP Bypass Settings ]
# ------------------------------------------------------------------------------
# Bypass China Mainland IPs: 0=Disable, 1=Enable
BYPASS_CN_IP=0

# CN IP File Paths
CN_IP_FILE="$RUN_DIR/cn.zone"
CN_IPV6_FILE="$RUN_DIR/cn_ipv6.zone"

# Download URLs
CN_IP_URL="https://raw.githubusercontent.com/Hackl0us/GeoIP2-CN/release/CN-ip-cidr.txt"
CN_IPV6_URL="https://ispip.clang.cn/all_cn_ipv6.txt"


# ------------------------------------------------------------------------------
# [ MAC Address Filter ] (Hotspot Mode Only)
# ------------------------------------------------------------------------------
# Enable MAC Filter: 0=Disable, 1=Enable
MAC_FILTER_ENABLE=0

# Mode: 1 = Blacklist (Default), 2 = Whitelist
MAC_PROXY_MODE=1

# Proxy MAC List (For Whitelist) - Space separated
PROXY_MACS_LIST=""

# Bypass MAC List (For Blacklist) - Space separated
BYPASS_MACS_LIST=""

